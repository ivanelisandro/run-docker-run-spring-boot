<div class="step-text">
<h5 id="description">Description</h5><p>You are at the most essential stage of your project. In this stage, you'll add more instructions to your <code class="java">Dockerfile</code>, which are needed to assemble a Docker image. The <code class="java">Dockerfile</code> will utilize a multi-stage build to first compile and package the application and then prepare it for deployment using a lightweight runtime environment.</p><p>This stage focuses on setting up the <code class="java">Dockerfile</code> with the necessary steps to build and package the application. Be aware that only the existence of the <code class="java">Dockerfile</code> and its instructions will be tested at this stage. We will test the running container and its behavior in the following stages.</p><h5 id="objectives">Objectives</h5><p>Create a multiple-stage Dockerfile:</p><ul><li><p>Stage 1 (Build):</p><ul><li><p>Use any valid JVM-based base image with a JDK to build your application (e.g., <code class="java">eclipse-temurin:21-jdk</code>)</p></li><li><p>Set the working directory inside the container to <code class="java">/app</code>.</p></li><li><p>Use the appropriate instruction to:</p><ul><li><p>Transfer the Gradle Wrapper files (<code class="java">gradlew</code>, <code class="java">gradlew.bat</code>);</p></li><li><p>Transfer the <code class="java">gradle</code> folder into the <code class="java">gradle</code> folder in the working directory;</p></li><li><p>Transfer the Gradle project files (<code class="java">build.gradle</code>, <code class="java">settings.gradle</code>) into the working directory;</p></li><li><p>Transfer the <code class="java">src</code> folder containing your application source code into the <code class="java">src</code> folder in the working directory.</p></li></ul></li><li><p>Ensure the Gradle Wrapper has executable permissions using the <code class="java">chmod +x gradlew</code> command.</p></li><li><p>Build the application with the command: <code class="java">./gradlew bootJar --no-daemon</code>.</p></li></ul></li><li><p>Stage 2 (Package):</p><ul><li><p>Use any valid JVM-based base image with a JRE to create a lightweight runtime environment for your application (e.g., <code class="java">eclipse-temurin:21-jre</code>);</p></li><li><p>Set the working directory inside the container to <code class="java">/app</code>;</p></li><li><p>Use the appropriate instruction to copy the JAR file generated in the build stage (<code class="java">/app/build/libs/hyper-web-app-0.0.1-SNAPSHOT.jar</code>) into the runtime stage directory as <code class="java">app.jar</code>;</p></li><li><p>Expose port <code class="java">8080</code>, which is the default port for Spring Boot applications;</p></li><li><p>Set the entry point to run the application using the command: <code class="java">["java", "-jar", "app.jar"]</code>.</p></li></ul></li></ul><p>You may use any valid tag or version for the images (e.g., <code class="java">latest</code>, <code class="java">21-jre</code>, <code class="java">17</code>).</p>
</div>